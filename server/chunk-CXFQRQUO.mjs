import './polyfills.server.mjs';
import{a as k,c as R,f as x}from"./chunk-KO2IYVKY.mjs";import{Aa as P,E as y,Ec as $,Hc as D,I,N as O,P as _,Q as v,S as d,Sa as w,V as p,W as u,Y as L,_ as l,c as b,ea as f,f as h,k as g,o as s,p as B,w as m}from"./chunk-AS6P2X7V.mjs";import{a as o,b as c}from"./chunk-5XUXGTUW.mjs";var M=class{constructor(t={}){this.config=t,this.state={action:null,value:0,initialValue:0},this.requests=null,this.disabled=!1,this.stream$=new h,this._value$=null,this.timer$=e=>{let i=g(e);switch(e.action){case"start":case"increment":case"set":{e.action==="start"&&this.config.latencyThreshold===0&&e.value===0&&(e.value=e.initialValue),this.requests>0&&(i=m(this.config.latencyThreshold,250).pipe(s(r=>c(o({},e),{value:r===0?this.state.value||e.initialValue:this._increment()}))));break}case"complete":case"stop":{i=e.value===0?g(o({},e)):m(0,500).pipe(y(2),s(r=>({value:r===0?100:0})));break}}return i.pipe(s(r=>c(o({},r),{action:"set"})),d(r=>this.next(r,!1)))},this.config=o({latencyThreshold:0},t)}get value$(){return this._value$?this._value$:this._value$=this.stream$.pipe(_(this.state),v(t=>this.timer$(t)),O(),s(t=>t.value))}start(t=2){this.disabled||this.next({action:"start",initialValue:t})}stop(){this.next({action:"stop"})}complete(){this.next({action:"complete"})}disable(){this.disabled=!0}set(t){this.next({action:"set",value:t})}increment(t=0){this.next({action:"increment",value:t})}next(t,e=!0){switch(t.action){case"start":this.requests=(this.requests||0)+1;break;case"complete":if(this.requests=(this.requests||1)-1,this.requests>0)return;break;case"stop":this.requests=0;break;case"increment":t.value=this._increment(t.value);break}this.state=o(c(o({},this.state),{action:null}),t),e&&this.stream$.next(this.state)}_increment(t=0){let e=this.state.value;return e>=99&&(t=0),t===0&&(e>=0&&e<25?t=Math.random()*3+3:e>=25&&e<65?t=Math.random()*3:e>=65&&e<90?t=Math.random()*2:e>=90&&e<99?t=.5:t=0),t+e}},T=new L("LOADING_BAR_CONFIG"),j=(()=>{class n{constructor(e,i={},r){this.platformId=e,this.config=i,this.zone=r,this.refs={},this.streams$=new h,this.value$=this.streams$.pipe(_(null),v(()=>B(Object.keys(this.refs).map(a=>this.refs[a].value$))),S(this.zone),s(a=>Math.max(0,...a)))}get progress$(){return this.value$}start(e=2){this.useRef().start(e)}set(e){this.useRef().set(e)}increment(e){this.useRef().increment(e)}complete(){this.useRef().complete()}stop(){this.useRef().stop()}useRef(e="default"){return this.refs[e]||(this.refs[e]=new M(this.config),this.streams$.next(),D(this.platformId)||this.refs[e].disable()),this.refs[e]}}return n.\u0275fac=function(e){return new(e||n)(l(P),l(T,8),l(w,8))},n.\u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function S(n){return n?t=>new b(e=>t.subscribe(i=>n.run(()=>e.next(i)),i=>n.run(()=>e.error(i)),()=>n.run(()=>e.complete()))):t=>t}var C=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=f({type:n}),n.\u0275inj=u({imports:[[$]]}),n})();var G=new k(()=>!1),H=(()=>{class n{constructor(e){this.loader=e}intercept(e,i){if(e.headers.has("ignoreLoadingBar"))return i.handle(e.clone({headers:e.headers.delete("ignoreLoadingBar")}));if(e.context.get(G)===!0)return i.handle(e);let r=!1,a=this.loader.useRef("http");return i.handle(e).pipe(d(()=>{r||(a.start(),r=!0)}),I(()=>r&&a.complete()))}}return n.\u0275fac=function(e){return new(e||n)(l(j))},n.\u0275prov=p({token:n,factory:n.\u0275fac}),n})(),ve=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=f({type:n}),n.\u0275inj=u({providers:[{provide:R,useClass:H,multi:!0}],imports:[[x,C],x,C]}),n})();export{j as a,C as b,ve as c};
